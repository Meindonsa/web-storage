{"version":3,"file":"index.js","mappings":"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","sources":["webpack://WebStorageService/webpack/universalModuleDefinition","webpack://WebStorageService/external umd \"crypto-js\"","webpack://WebStorageService/external umd \"lz-string\"","webpack://WebStorageService/webpack/bootstrap","webpack://WebStorageService/webpack/runtime/compat get default export","webpack://WebStorageService/webpack/runtime/define property getters","webpack://WebStorageService/webpack/runtime/hasOwnProperty shorthand","webpack://WebStorageService/webpack/runtime/make namespace object","webpack://WebStorageService/./src/crypto.service.ts","webpack://WebStorageService/./src/constant.ts","webpack://WebStorageService/./src/web-storage.service.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"crypto-js\"), require(\"lz-string\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"crypto-js\", \"lz-string\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WebStorageService\"] = factory(require(\"crypto-js\"), require(\"lz-string\"));\n\telse\n\t\troot[\"WebStorageService\"] = factory(root[\"crypto-js\"], root[\"lz-string\"]);\n})(this, (__WEBPACK_EXTERNAL_MODULE__475__, __WEBPACK_EXTERNAL_MODULE__604__) => {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__475__;","module.exports = __WEBPACK_EXTERNAL_MODULE__604__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import * as crypto from \"crypto-js\";\nimport LZString from \"lz-string\";\nvar CryptoService = /** @class */ (function () {\n    function CryptoService() {\n    }\n    CryptoService.prototype.encrypt = function (data, secretKey) {\n        try {\n            var encryptedData = crypto.AES.encrypt(JSON.stringify(data), secretKey, {\n                keySize: 256 / 32,\n                mode: crypto.mode.CBC,\n                padding: crypto.pad.Pkcs7,\n            }).toString();\n            return LZString.compressToUTF16(encryptedData);\n        }\n        catch (error) {\n            console.error(\"Encryption error:\", error);\n            throw error;\n        }\n    };\n    CryptoService.prototype.decrypt = function (encryptedData, secretKey) {\n        try {\n            var decompressedData = LZString.decompressFromUTF16(encryptedData);\n            if (!decompressedData) {\n                console.error(\"Decompression failed, data is null or empty\");\n                throw new Error(\"Decompression failed\");\n            }\n            var originalData = crypto.AES.decrypt(decompressedData, secretKey, {\n                keySize: 256 / 32,\n                mode: crypto.mode.CBC,\n                padding: crypto.pad.Pkcs7,\n            }).toString(crypto.enc.Utf8);\n            if (!originalData) {\n                console.error(\"Decryption failed, possibly due to incorrect key\");\n                throw new Error(\"Decryption failed\");\n            }\n            return JSON.parse(originalData);\n        }\n        catch (error) {\n            console.error(\"Decryption error:\", error);\n            throw error;\n        }\n    };\n    CryptoService.prototype.generateRandomKey = function (length) {\n        if (length === void 0) { length = 60; }\n        var randomBytes = crypto.lib.WordArray.random(length / 2);\n        return crypto.enc.Hex.stringify(randomBytes);\n    };\n    return CryptoService;\n}());\nexport { CryptoService };\n","export var Constant = {\n    keys_name: \"_secure_storage\",\n    base_key: \"ABCDEFGHIJKLMNOPQRSTUVWXYZ#abcdefghijklmnopqrstuvwxyz@0123456789\",\n    iv: \"8f3e5abe9f0406905fd09f8e8d5b30d8\",\n};\n","import { CryptoService } from \"./crypto.service\";\nimport { Constant } from \"./constant\";\nvar WebStorageService = /** @class */ (function () {\n    function WebStorageService() {\n        this.metaData = null;\n        this.cryptoService = new CryptoService();\n        this._init();\n    }\n    WebStorageService.prototype._init = function () {\n        var metaData = {\n            _keyStr: this.cryptoService.generateRandomKey(),\n            array: null,\n        };\n        var object = localStorage.getItem(Constant.keys_name) || null;\n        if (!object) {\n            var encrypted = this.cryptoService.encrypt(metaData, Constant.base_key);\n            if (encrypted)\n                localStorage.setItem(Constant.keys_name, encrypted);\n        }\n    };\n    WebStorageService.prototype._getMetaData = function () {\n        var object = localStorage.getItem(Constant.keys_name);\n        if (!object) {\n            console.error(\"Metadata not found in localStorage.\");\n            return null;\n        }\n        return this.cryptoService.decrypt(object, Constant.base_key);\n    };\n    WebStorageService.prototype.set = function (key, data, secretKey) {\n        if (secretKey === void 0) { secretKey = null; }\n        this.metaData = this._getMetaData();\n        if (!this.metaData || !this.metaData._keyStr) {\n            console.error(\"Meta data is missing or invalid.\");\n            return;\n        }\n        var encryptedKey = secretKey !== null && secretKey !== void 0 ? secretKey : this.metaData._keyStr;\n        var dataKey = this.cryptoService.generateRandomKey();\n        var encryptedData = this.cryptoService.encrypt(data, dataKey);\n        if (encryptedData) {\n            this.updateMetaData(dataKey, encryptedKey, key);\n            localStorage.setItem(key, encryptedData);\n        }\n    };\n    WebStorageService.prototype.updateMetaData = function (dataKey, encryptedKey, key) {\n        var array = new Map();\n        if (this.metaData.array == null) {\n            array.set(key, dataKey);\n        }\n        else {\n            var list = this.decryptArray(this.metaData.array, encryptedKey);\n            if (list) {\n                array = new Map(list);\n            }\n            array.set(key, dataKey);\n        }\n        var encryptedArray = this.encryptArray(Array.from(array), encryptedKey);\n        this.metaData.array = encryptedArray;\n        this.metaData = this.encryptMetaData(this.metaData, Constant.base_key);\n        localStorage.setItem(Constant.keys_name, this.metaData);\n        this.metaData = null;\n    };\n    WebStorageService.prototype.get = function (key, secretKey) {\n        if (secretKey === void 0) { secretKey = null; }\n        this.metaData = this._getMetaData();\n        if (!this.metaData) {\n            console.error(\"Failed to retrieve meta data.\");\n            return null;\n        }\n        var encryptedKey = secretKey !== null && secretKey !== void 0 ? secretKey : this.metaData._keyStr;\n        var array = this.getArray(encryptedKey);\n        if (!array || array.size === 0)\n            return null;\n        var encryptedData = localStorage.getItem(key);\n        if (!encryptedData)\n            return null;\n        this.metaData = null;\n        var dataKey = array.get(key);\n        if (!dataKey) {\n            console.error(\"Data key not found in array.\");\n            return null;\n        }\n        try {\n            return this.cryptoService.decrypt(encryptedData, dataKey);\n        }\n        catch (err) {\n            console.error(\"Decryption error:\", err);\n            throw err;\n        }\n    };\n    WebStorageService.prototype.remove = function (key) {\n        localStorage.removeItem(key);\n    };\n    WebStorageService.prototype.removeAll = function () {\n        localStorage.clear();\n    };\n    WebStorageService.prototype.getArray = function (encryptionKey) {\n        var array = new Map();\n        if (this.metaData.array == null) {\n            return array;\n        }\n        var arrayList = this.decryptArray(this.metaData.array, encryptionKey);\n        if (arrayList) {\n            array = new Map(arrayList);\n        }\n        return array;\n    };\n    WebStorageService.prototype.encryptArray = function (data, key) {\n        var metaData = this._getMetaData();\n        if (!metaData)\n            return \"\";\n        return this.cryptoService.encrypt(data, key);\n    };\n    WebStorageService.prototype.decryptArray = function (data, key) {\n        var metaData = this._getMetaData();\n        if (!metaData)\n            return [];\n        return this.cryptoService.decrypt(data, key);\n    };\n    WebStorageService.prototype.encryptMetaData = function (data, key) {\n        return this.cryptoService.encrypt(data, key);\n    };\n    return WebStorageService;\n}());\nexport { WebStorageService };\n"],"names":["root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE__475__","__WEBPACK_EXTERNAL_MODULE__604__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","CryptoService","encrypt","data","secretKey","encryptedData","JSON","stringify","keySize","mode","CBC","padding","Pkcs7","toString","error","console","decrypt","decompressedData","Error","originalData","Utf8","parse","generateRandomKey","length","randomBytes","WordArray","random","Hex","Constant","keys_name","base_key","iv","WebStorageService","metaData","cryptoService","_init","_keyStr","array","localStorage","getItem","encrypted","setItem","_getMetaData","object","set","encryptedKey","dataKey","updateMetaData","Map","list","decryptArray","encryptedArray","encryptArray","Array","from","encryptMetaData","getArray","size","err","remove","removeItem","removeAll","clear","encryptionKey","arrayList"],"sourceRoot":""}