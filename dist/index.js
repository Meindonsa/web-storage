!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("crypto-js"),require("lz-string")):"function"==typeof define&&define.amd?define(["crypto-js","lz-string"],t):"object"==typeof exports?exports.WebStorageService=t(require("crypto-js"),require("lz-string")):e.WebStorageService=t(e["crypto-js"],e["lz-string"])}(this,((e,t)=>(()=>{"use strict";var r={475:t=>{t.exports=e},604:e=>{e.exports=t}},a={};function o(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={exports:{}};return r[e](n,n.exports,o),n.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};o.r(n),o.d(n,{Constant:()=>p,CryptoService:()=>y,WebStorageService:()=>l});var i=o(475),c=o(604),s=o.n(c),y=function(){function e(){}return e.prototype.encrypt=function(e,t){try{var r=i.AES.encrypt(JSON.stringify(e),t,{keySize:8,mode:i.mode.CBC,padding:i.pad.Pkcs7}).toString();return s().compressToUTF16(r)}catch(e){throw console.error("Encryption error:",e),e}},e.prototype.decrypt=function(e,t){try{var r=s().decompressFromUTF16(e);if(!r)throw console.error("Decompression failed, data is null or empty"),new Error("Decompression failed");var a=i.AES.decrypt(r,t,{keySize:8,mode:i.mode.CBC,padding:i.pad.Pkcs7}).toString(i.enc.Utf8);if(!a)throw console.error("Decryption failed, possibly due to incorrect key"),new Error("Decryption failed");return JSON.parse(a)}catch(e){throw console.error("Decryption error:",e),e}},e.prototype.generateRandomKey=function(e){void 0===e&&(e=60);var t=i.lib.WordArray.random(e/2);return i.enc.Hex.stringify(t)},e}(),p={keys_name:"_secure_storage",base_key:"ABCDEFGHIJKLMNOPQRSTUVWXYZ#abcdefghijklmnopqrstuvwxyz@0123456789",iv:"8f3e5abe9f0406905fd09f8e8d5b30d8"},l=function(){function e(){this.metaData=null,this.cryptoService=new y,this._init()}return e.prototype._init=function(){var e={_keyStr:this.cryptoService.generateRandomKey(),array:null};if(!localStorage.getItem(p.keys_name)){var t=this.cryptoService.encrypt(e,p.base_key);t&&localStorage.setItem(p.keys_name,t)}},e.prototype._getMetaData=function(){var e=localStorage.getItem(p.keys_name);return e?this.cryptoService.decrypt(e,p.base_key):(console.error("Metadata not found in localStorage."),null)},e.prototype.set=function(e,t,r){if(void 0===r&&(r=null),this.metaData=this._getMetaData(),this.metaData&&this.metaData._keyStr){var a=null!=r?r:this.metaData._keyStr,o=this.cryptoService.generateRandomKey(),n=this.cryptoService.encrypt(t,o);n&&(this.updateMetaData(o,a,e),localStorage.setItem(e,n))}else console.error("Meta data is missing or invalid.")},e.prototype.updateMetaData=function(e,t,r){var a=new Map;if(null==this.metaData.array)a.set(r,e);else{var o=this.decryptArray(this.metaData.array,t);o&&(a=new Map(o)),a.set(r,e)}var n=this.encryptArray(Array.from(a),t);this.metaData.array=n,this.metaData=this.encryptMetaData(this.metaData,p.base_key),localStorage.setItem(p.keys_name,this.metaData),this.metaData=null},e.prototype.get=function(e,t){if(void 0===t&&(t=null),this.metaData=this._getMetaData(),!this.metaData)return console.error("Failed to retrieve meta data."),null;var r=null!=t?t:this.metaData._keyStr,a=this.getArray(r);if(!a||0===a.size)return null;var o=localStorage.getItem(e);if(!o)return null;this.metaData=null;var n=a.get(e);if(!n)return console.error("Data key not found in array."),null;try{return this.cryptoService.decrypt(o,n)}catch(e){throw console.error("Decryption error:",e),e}},e.prototype.remove=function(e){localStorage.removeItem(e)},e.prototype.removeAll=function(){localStorage.clear()},e.prototype.getArray=function(e){var t=new Map;if(null==this.metaData.array)return t;var r=this.decryptArray(this.metaData.array,e);return r&&(t=new Map(r)),t},e.prototype.encryptArray=function(e,t){return this._getMetaData()?this.cryptoService.encrypt(e,t):""},e.prototype.decryptArray=function(e,t){return this._getMetaData()?this.cryptoService.decrypt(e,t):[]},e.prototype.encryptMetaData=function(e,t){return this.cryptoService.encrypt(e,t)},e}();return n})()));
//# sourceMappingURL=index.js.map